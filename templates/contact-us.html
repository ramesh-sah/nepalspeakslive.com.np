{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css" />

<div class="relative   bg-[#FFFFFF] bg-[#dee3ca]backdrop-filter: blur(12px) min-h-screen py-16">
    <div class="w-full max-w-full mx-auto px-0">
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-10 border border-gray-100">
            
            <!-- Header -->
            <div class="text-center mb-10">
                <h2 class="text-4xl font-bold text-gray-900 mb-3">
                    How Can We Help You?
                </h2>
                <p class="text-gray-600 text-lg">
                    We're here to answer your questions and help you find the right solution.  
                    Fill out the form below — our team will get back to you shortly.
                </p>
            </div>

            <!-- Django Messages -->
            {% if messages %}
            <div class="mb-6 space-y-3">
                {% for message in messages %}
                <div class="p-4 text-sm rounded-lg 
                    {% if message.tags == 'success' %}
                        bg-green-100 text-green-800 border border-green-300
                    {% elif message.tags == 'error' %}
                        bg-red-100 text-red-800 border border-red-300
                    {% else %}
                        bg-blue-100 text-blue-800 border border-blue-300
                    {% endif %}
                ">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Enquiry Form -->
            <form method="post" class="space-y-6" novalidate>
                {% csrf_token %}

                <!-- Full Name -->
                <div>
                    <label for="full-name" class="block text-gray-800 font-medium mb-2">Full Name</label>
                    <input
                        type="text"
                        id="full-name"
                        name="full_name"
                        value="{{ request.POST.full_name|default:'' }}"
                        placeholder="e.g., John Doe"
                        required
                        class="w-full border border-gray-300 rounded-lg py-3 px-4 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                    />
                </div>

                <!-- Email -->
                <div>
                    <label for="email" class="block text-gray-800 font-medium mb-2">Email Address</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        value="{{ request.POST.email|default:'' }}"
                        placeholder="you@example.com"
                        required
                        class="w-full border border-gray-300 rounded-lg py-3 px-4 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                    />
                </div>

                <!-- Phone with Country Code -->
                <div>
                    <label for="phone" class="block text-gray-800 font-medium mb-2">Phone Number</label>
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        value="{{ request.POST.phone|default:'' }}"
                        placeholder="Enter your phone number"
                        required
                        class="w-full border border-gray-300 rounded-lg py-3 px-4 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                    />
                    <input type="hidden" id="country_code" name="country_code" value="{{ request.POST.country_code|default:'' }}">
                </div>

                <!-- Inquiry -->
                <div>
                    <label for="inquiry" class="block text-gray-800 font-medium mb-2">Your Message</label>
                    <textarea
                        id="inquiry"
                        name="inquiry"
                        rows="6"
                        placeholder="Tell us more about what you’re looking for..."
                        required
                        class="w-full border border-gray-300 rounded-lg py-3 px-4 text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                    >{{ request.POST.inquiry|default:'' }}</textarea>
                </div>

                <!-- Submit Button -->
                <div class="pt-4 text-right">
                    <button
                        type="submit"
                        class="inline-block bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-8 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2"
                    >
                        Send Message
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Phone Input Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script>
    const phoneInput = document.querySelector("#phone");
    const countryCodeInput = document.querySelector("#country_code");

    // Initialize intl-tel-input
    const iti = window.intlTelInput(phoneInput, {
        initialCountry: "auto",
        separateDialCode: true,
        preferredCountries: ['us', 'gb', 'ca', 'au', 'in', 'np'],
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        geoIpLookup: (callback) => {
            fetch("https://ipinfo.io/json")
                .then((res) => res.json())
                .then((data) => callback(data.country))
                .catch(() => callback("us"));
        },
    });

    // Update hidden input
    phoneInput.addEventListener("countrychange", () => {
        countryCodeInput.value = iti.getSelectedCountryData().dialCode;
    });

    // Set default on load
    window.addEventListener("load", () => {
        countryCodeInput.value = iti.getSelectedCountryData().dialCode;
    });

    // Validate before submit
    document.querySelector("form").addEventListener("submit", (e) => {
        if (!iti.isValidNumber()) {
            e.preventDefault();
            alert("Please enter a valid phone number before submitting.");
        }
    });
</script>
{% endblock %}
